<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- 适配移动设备 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <!-- 启用全屏显示 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- 设置状态栏颜色 -->
    <meta name="theme-color" content="#000000">
    <!-- 链接到 manifest 文件 -->
    <link rel="manifest" href="manifest.json">
    <!-- iOS 图标 -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <title>倒计时</title>
    <style>
        <!-- 省略，保持与之前版本一致 -->
    </style>
</head>
<body>
    <!-- 省略，保持与之前版本一致 -->

    <script>
        // ...（之前的代码保持不变）

        let wakeLock = null;

        // 申请屏幕唤醒锁
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {
                        console.log('Screen Wake Lock released');
                    });
                    console.log('Screen Wake Lock acquired');
                } else {
                    console.log('Screen Wake Lock API not supported');
                }
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        }

        // 释放屏幕唤醒锁
        async function releaseWakeLock() {
            if (wakeLock !== null) {
                await wakeLock.release();
                wakeLock = null;
                console.log('Screen Wake Lock released manually');
            }
        }

        // 在计时器开始时申请唤醒锁
        function startTimer() {
            clearInterval(countdown);
            const now = Date.now();
            const then = now + timeRemaining * 1000;
            displayTime(timeRemaining);

            // 申请屏幕唤醒锁
            requestWakeLock();

            countdown = setInterval(() => {
                timeRemaining = Math.round((then - Date.now()) / 1000);
                if (timeRemaining < 0) {
                    clearInterval(countdown);
                    // 计时结束后释放唤醒锁
                    releaseWakeLock();
                    return;
                }
                displayTime(timeRemaining);
            }, 1000);
        }

        // 在计时器暂停或重置时释放唤醒锁
        function pauseTimer() {
            clearInterval(countdown);
            releaseWakeLock();
        }

        function resetTimer() {
            clearInterval(countdown);
            timeRemaining = initialTime;
            displayTime(timeRemaining);
            releaseWakeLock();
        }

        // 当页面可见性改变时，重新申请唤醒锁
        document.addEventListener('visibilitychange', () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                requestWakeLock();
            }
        });

        // ...（其他代码保持不变）
    </script>
</body>
</html>