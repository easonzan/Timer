<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Adapt to mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <!-- Force full-screen display when launched from home screen -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Set status bar color -->
    <meta name="theme-color" content="#000000">
    <!-- Link to the manifest file -->
    <link rel="manifest" href="manifest.json">
    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <title>Countdown Timer</title>
    <style>
        :root {
            --bg-color: #000000;
            --timer-color: #FFFFFF;
            --control-bg-color: transparent;
            --control-text-color: #FFFFFF;
            --accent-color: #ff5722;
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            text-align: center;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--timer-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            position: relative;
        }
        #timer {
            font-size: calc(20vmin);
            margin: 0;
            color: var(--timer-color);
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
            user-select: none;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        @media (orientation: landscape) {
            #timer {
                font-size: calc(35vmin);
            }
        }
        .controls {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            gap: 1em;
            width: auto;
            padding: 0 1em;
            z-index: 1000;
        }
        .controls button {
            font-size: 1em;
            padding: 0.5em;
            border: none;
            background-color: var(--control-bg-color);
            color: var(--control-text-color);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
        }
        .controls button:hover {
            color: var(--accent-color);
        }
        .controls button svg {
            width: 24px;
            height: 24px;
        }
        .settings-popup {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            padding: 1em;
            z-index: 2000;
        }
        .settings-content {
            background-color: #2c2c2c;
            padding: 1em;
            border-radius: 10px;
            width: 100%;
            max-width: 300px;
            text-align: left;
        }
        .settings-content h3 {
            margin-top: 0;
            color: #fff;
            text-align: center;
        }
        .settings-content label {
            margin: 0.5em 0;
            display: block;
            font-size: 1em;
            color: #fff;
        }
        .settings-content input {
            width: 100%;
            padding: 0.3em;
            margin-bottom: 0.5em;
            border: none;
            border-radius: 5px;
            background-color: #444;
            color: #fff;
        }
        #close-settings {
            margin-top: 1em;
            padding: 0.5em;
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        /* Install prompt styles for iOS */
        #ios-install-prompt {
            display: none;
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2c2c2c;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 3000;
        }
        #ios-install-prompt button {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        /* Adjust for safe areas on iOS */
        @supports(padding-bottom: env(safe-area-inset-bottom)) {
            body {
                padding-bottom: env(safe-area-inset-bottom);
            }
            .controls {
                top: calc(env(safe-area-inset-top) + 10px);
            }
        }
    </style>
</head>
<body>
    <div id="timer">01:00</div>
    <div class="controls">
        <button id="settings-button" aria-label="Settings">
            <svg viewBox="0 0 24 24">
                <!-- Gear icon -->
                <path fill="currentColor" d="M12 15.5C13.93 15.5 15.5 13.93 15.5 12S13.93 8.5 12 8.5 8.5 10.07 8.5 12 10.07 15.5 12 15.5M19.43 12.97C19.46 12.65 19.5 12.33 19.5 12S19.46 11.35 19.43 11.03L21.5 9.9 19.95 7.05 17.75 7.5C17.32 6.85 16.77 6.27 16.13 5.75L16.5 3.5 13.5 2 12 4.5C11.67 4.5 11.33 4.5 11 4.5S10.33 4.5 10 4.5L8.5 2 5.5 3.5 5.87 5.75C5.23 6.27 4.68 6.85 4.25 7.5L2.05 7.05 0.5 9.9 2.57 11.03C2.54 11.35 2.5 11.67 2.5 12S2.54 12.65 2.57 12.97L0.5 14.1 2.05 16.95 4.25 16.5C4.68 17.15 5.23 17.73 5.87 18.25L5.5 20.5 8.5 22 10 19.5C10.33 19.5 10.67 19.5 11 19.5S11.67 19.5 12 19.5L13.5 22 16.5 20.5 16.13 18.25C16.77 17.73 17.32 17.15 17.75 16.5L19.95 16.95 21.5 14.1 19.43 12.97Z" />
            </svg>
        </button>
        <button id="start" aria-label="Start">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M8 5v14l11-7z"/>
            </svg>
        </button>
        <button id="pause" aria-label="Pause">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
        </button>
        <button id="reset" aria-label="Reset">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M13 3a9 9 0 0 1 0 18c-4.97 0-9-4.03-9-9H1l4-4 4 4H6a7 7 0 1 0 7-7V3z"/>
            </svg>
        </button>
    </div>
    <!-- iOS Install Prompt -->
    <div id="ios-install-prompt">
        Install this app on your device: tap <img src="share-icon.png" alt="Share" style="width:16px;height:16px;vertical-align:middle;"> and then 'Add to Home Screen'.
        <button id="close-ios-prompt">Close</button>
    </div>
    <div class="settings-popup" id="settings-container">
        <div class="settings-content">
            <h3>Settings</h3>
            <label for="timeInput">Countdown Time (seconds):</label>
            <input type="number" id="timeInput" value="60" min="1">
            <label for="bgColor">Background Color:</label>
            <input type="color" id="bgColor" value="#000000">
            <label for="timerColor">Timer Color:</label>
            <input type="color" id="timerColor" value="#ffffff">
            <button id="close-settings">Save Settings</button>
        </div>
    </div>
    <script>
        // Register the service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
            .then(registration => {
                console.log('ServiceWorker registration successful with scope:', registration.scope);
            })
            .catch(error => {
                console.log('ServiceWorker registration failed:', error);
            });
        }

        // iOS Install Prompt
        const isiOS = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
        const isInStandaloneMode = ('standalone' in window.navigator) && window.navigator.standalone;
        const iosInstallPrompt = document.getElementById('ios-install-prompt');
        const closeIosPromptButton = document.getElementById('close-ios-prompt');

        if (isiOS && !isInStandaloneMode) {
            iosInstallPrompt.style.display = 'flex';
        }

        closeIosPromptButton.addEventListener('click', () => {
            iosInstallPrompt.style.display = 'none';
        });

        let timer;
        let remainingTime;
        let isPaused = true;
        let countingUp = false;
        const timerDisplay = document.getElementById('timer');
        const startButton = document.getElementById('start');
        const pauseButton = document.getElementById('pause');
        const resetButton = document.getElementById('reset');
        const settingsButton = document.getElementById('settings-button');
        const settingsContainer = document.getElementById('settings-container');
        const closeSettingsButton = document.getElementById('close-settings');
        const timeInput = document.getElementById('timeInput');
        const bgColorInput = document.getElementById('bgColor');
        const timerColorInput = document.getElementById('timerColor');

        function updateDisplay(seconds) {
            const absSeconds = Math.abs(seconds);
            const minutes = Math.floor(absSeconds / 60);
            const remainderSeconds = absSeconds % 60;
            const timeString = `${minutes < 10 ? '0' : ''}${minutes}:${remainderSeconds < 10 ? '0' : ''}${remainderSeconds}`;
            if (seconds >= 0) {
                timerDisplay.textContent = timeString;
            } else {
                timerDisplay.textContent = `+${timeString}`;
            }
        }

        function startTimer() {
            const seconds = parseInt(timeInput.value);
            if (isPaused) {
                remainingTime = remainingTime ?? seconds;
                isPaused = false;
                timer = setInterval(() => {
                    if (remainingTime <= 0 && !countingUp) {
                        countingUp = true;
                        remainingTime = 0;
                        navigator.vibrate(500);
                    } else if (!countingUp) {
                        remainingTime--;
                    } else {
                        remainingTime--;
                    }
                    updateDisplay(remainingTime);
                }, 1000);
                preventScreenSleep();
            }
        }

        function pauseTimer() {
            isPaused = true;
            clearInterval(timer);
        }

        function resetTimer() {
            isPaused = true;
            countingUp = false;
            clearInterval(timer);
            remainingTime = parseInt(timeInput.value);
            updateDisplay(remainingTime);
        }

        function toggleSettings() {
            settingsContainer.style.display = 'flex';
        }

        function saveSettings() {
            document.body.style.backgroundColor = bgColorInput.value;
            timerDisplay.style.color = timerColorInput.value;
            document.documentElement.style.setProperty('--bg-color', bgColorInput.value);
            document.documentElement.style.setProperty('--timer-color', timerColorInput.value);
            remainingTime = parseInt(timeInput.value);
            updateDisplay(remainingTime);
            settingsContainer.style.display = 'none';
        }

        function preventScreenSleep() {
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen').catch((err) => {
                    console.error('Screen wake lock request failed:', err);
                });
            }
        }

        settingsButton.addEventListener('click', toggleSettings);
        closeSettingsButton.addEventListener('click', saveSettings);
        startButton.addEventListener('click', startTimer);
        pauseButton.addEventListener('click', pauseTimer);
        resetButton.addEventListener('click', resetTimer);

        // Initial setup
        resetTimer();
    </script>
</body>
</html>
